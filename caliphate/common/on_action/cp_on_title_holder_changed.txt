on_title_lost = {
	on_actions = {
		hof_primary_title_holder_changed
	}
}

hof_primary_title_holder_changed = {
	effect = {
		if = {
			limit = {
				# プライマリータイトルを失ったか?
				scope:title.tier > root.highest_held_title_tier
				# 新たな所有者の封臣に成り下がったか?
				root = { is_vassal_of = scope:new_holder }
				# 新しい所有者のHoFは旧所持者か?
				scope:new_holder.faith = root.faith
				scope:new_holder.faith.religious_head = root
				# 家同じか?
				scope:new_holder.house = root.house
			}

			scope:new_holder = {
				house ?= { set_house_head = scope:new_holder }
			}

			root = {
				every_held_title = {
					limit = { is_head_of_faith = yes }
					save_scope_as = title_to_transfer
				}
			}
			create_title_and_vassal_change = {
				type = usurped
				save_scope_as = change
				add_claim_on_loss = no
			}
			scope:title_to_transfer = {
				change_title_holder = {
					holder = scope:new_holder
					change = scope:change
				}
			}

			resolve_title_and_vassal_change = scope:change
		}
	}
}

on_title_gain = {
	on_actions = {
		on_house_election
	}
}

on_house_election = {
	effect = {
		if = {
			limit = {
				scope:title = { has_title_law = cp_house_elective_succession_law }
			}
			root = {
				house ?= { set_house_head = root }
			}
		}
	}
}